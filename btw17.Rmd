---
title: "BTW 2017"
author: "People"
date: "`r Sys.time()`"
output: 
  html_document: 
    self_contained: no
    toc: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.path = "plots/")

source("dataprep.R")

theme_set(tadaatoolbox::theme_tadaa())
```

## Distribution

```{r distribution}
btw17 %>%
  mutate(Laendernamen = map_chr(Land, num2name)) %>%
  select(Laendernamen, `Wahlberechtigte (A)`, `Wähler (B)`, `Ungültige`:`Übrige`) %>%
  gather(key = Partei, value = Stimmen, CDU:`Übrige`) %>%
  group_by(Partei) %>%
  summarise(Prozent = sum(Stimmen) / sum(`Gültige`)) %>%
  mutate(Parteien = ifelse(Prozent <= .05, "Sonstige", Partei)) %>% 
  ggplot(aes(x = reorder(Parteien, Prozent), y = Prozent, fill = Parteien)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_manual(breaks = names(partei_colors), values = partei_colors) +
  labs(title = "Stimmanteil aller Parteien", x = "Partei") +
  coord_flip()
```


### Distribution by State

```{r distribution_by_state}
btw_long %>%
  ggplot(aes(x = reorder(Parteien, Prozent), y = Prozent, fill = Parteien)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_manual(breaks = names(partei_colors), values = partei_colors) +
  labs(title = "Stimmanteil aller Parteien >5% pro Bundesland") +
  facet_wrap(~Laendernamen) +
  coord_flip()
```
